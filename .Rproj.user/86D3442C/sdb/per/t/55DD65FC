{
    "collab_server" : "",
    "contents" : "#0.7089947  SEM PONTOS DO TIME - CORRETO ESSE CRITERIO\n#0.7513228 com parametros\n#0.7301587 sem parametros e search\n\n#0.6046512\n#0.6860465\n#0.6860465\n#0.6860465\n#0.6744186\n#0.6860465\n#0.7093023\n#0.627907\n#0.6976744\n#0.7093023\n#0.7209302\n#0.7674419 agora na aula\n\n\n\n\n#0.744186\n#0.755814 com altura nfolds = 100,\n#0.709302 com altura nfolds = 10,\n#0.7093023 com altura\n#0.6976744 sem altura\nlibrary(h2o)\nlibrary(ggplot2)\nlibrary(plyr)\n\nset.seed(1234);\n\n\nsource(\"scripts/functions.R\")\n\nh2o.init(nthreads = -1)\noptions(scipen=20)\n\n#h2o.set.seed(1234);\n#nao ler toda hora\nif (!file.exists(\"dadosOriginalCSV\")) {\n  dadosOriginalCSV <- readData();\n  \n}\n\n\ntreino <- getTreinoData(dadosOriginalCSV)\nvalidacao <- getValidacaoData(dadosOriginalCSV)\nteste <- getTesteData(dadosOriginalCSV)\n\ntreino.hex  <- as.h2o(treino) # convertendo df para formato h2o\nvalidacao.hex  <- as.h2o(validacao) \nteste.hex  <- as.h2o(teste) \n\nx <- setdiff(names(dadosOriginalCSV), c(dadosOriginalCSV,\"posicao\", \"minutos_partida\", \"ts_per\", \"eFG_per\",\"ASTPer\", \"TurPer\", \"FTPer\", \"FG_per\", \"PirPer\",  \"idade\",\"pontos_time_casa\",\"pontos_time_fora\", \"id_jogador\",\"id_partida\", \"data_nascimento\", \"violacao\", \"faltas_recebidas\" ))  #retirando colunas nao necessarias ao processo\ny <- \"posicao\"\n\n#\n\nhyper_parametersDP <- list(\n     hidden=list(c(32,32,32),c(64,64)),\n     input_dropout_ratio=c(0,0.05),\n     rate=c(0.01,0.02)\n     \n)\n\n\n#set search criteria\nsearch_criteriaDP <- list(strategy = \"RandomDiscrete\", max_models=400)\n\n\ngridDL <- h2o.grid(\"deeplearning\", \n                   grid_id=\"dl_grid_test\", \n                   x=x, \n                   y=y, \n                   training_frame=treino.hex, \n                   validation_frame=validacao.hex, \n                   epochs=10,\n                   seed = 1234,\n                   variable_importances = T,\n                   reproducible = TRUE,\n                   \n                   #stopping_metric=\"misclassification\",\n                   #stopping_tolerance=1e-2,        ## stop when misclassification does not improve by >=1% for 2 scoring events\n                   #stopping_rounds=2,\n                   #score_validation_samples=10000, ## downsample validation set for faster scoring\n                   #score_duty_cycle=0.025,         ## don't score more than 2.5% of the wall time\n                   #adaptive_rate=F,                ## manually tuned learning rate\n                   #momentum_start=0.5,             ## manually tuned momentum\n                   #momentum_stable=0.9, \n                   #momentum_ramp=1e7, \n                   #l1=1e-5,\n                   #l2=1e-5,\n                   #activation=c(\"Rectifier\"),\n                   #max_w2=10,\n                   nfolds = 10,\n                   hyper_params = hyper_parametersDP,\n                  search_criteria = search_criteriaDP\n                   )\n\ndl_sorted_grid <- h2o.getGrid(grid_id = \"dl_grid_test\", sort_by = \"accuracy\", decreasing = TRUE)\n\nprint(dl_sorted_grid, exact_quantiles=TRUE)\n\n\n# Grab the model_id based in AUC\nbest_dl_model_id <- gridDL@model_ids[[1]]\n\n# The best model\nbest_dl <- h2o.getModel(best_dl_model_id)\n\nprint(h2o.performance(best_dl, valid=T))\n\n\n\nmy_varimpDL <- h2o.varimp(best_dl)\nbarplot(my_varimpDL$scaled_importance,\n        names.arg = my_varimpDL$variable,\n        space = 1,\n        las = 2,\n        main = \"Variable Importance: DL GRID\")\n\nmodel = best_dl\n\n# Summary of the best model\npred2 = h2o.predict(object = model, newdata = teste.hex)\n\ndataset_pred <- as.data.frame(pred2)\n\n\nsub_reg <- data.frame(id_jogador = teste$id_jogador,  id_partida = teste$id_partida, temporada = teste$nome_temporada, posicao =  dataset_pred$predict)\n\n\nfinal <- cbind(dataset_pred, teste ) \n#erro =  sqldf( \"select * from final where predict != posicao\")\n\nperf <- h2o.performance(model, teste.hex)\nh2o.confusionMatrix(perf)\n\nmean(pred2$predict==teste.hex$posicao)\n#h2o.shutdown(prompt=FALSE)\n",
    "created" : 1498909779084.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1271456208",
    "id" : "55DD65FC",
    "lastKnownWriteTime" : 1499179986,
    "last_content_update" : 1499179986844,
    "path" : "~/Downloads/MDM 2/MDM Predict 5p/scripts/gridDL.R",
    "project_path" : "scripts/gridDL.R",
    "properties" : {
    },
    "relative_order" : 4,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}